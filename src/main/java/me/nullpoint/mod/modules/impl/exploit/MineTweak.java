package me.nullpoint.mod.modules.impl.exploit;

import me.nullpoint.api.utils.entity.InventoryUtil;
import me.nullpoint.mod.modules.Module;
import me.nullpoint.mod.modules.settings.impl.BooleanSetting;
import net.minecraft.item.Items;
import net.minecraft.item.PickaxeItem;
import net.minecraft.item.SwordItem;

public class MineTweak extends Module {

    public static MineTweak INSTANCE;
    public final BooleanSetting noEntityTrace =
            add(new BooleanSetting("NoEntityTrace", true).setParent());
    public final BooleanSetting onlyPickaxe =
            add(new BooleanSetting("OnlyPickaxe", true, v -> noEntityTrace.isOpen()));
    public final BooleanSetting multiTask =
            add(new BooleanSetting("MultiTask", true));
    private final BooleanSetting noAbort =
            add(new BooleanSetting("NoAbort", true));
    private final BooleanSetting noReset =
            add(new BooleanSetting("NoReset", true));
    private final BooleanSetting noDelay =
            add(new BooleanSetting("NoDelay", true));
    private final BooleanSetting pickaxeSwitch =
            add(new BooleanSetting("SwitchEat", true));
    public final BooleanSetting ghostHand =
            add(new BooleanSetting("GhostHand", true));
    public MineTweak() {
        super("MineTweak", Category.Exploit);
        INSTANCE = this;
    }

    boolean swapped = false;
    int lastSlot = 0;

    @Override
    public void onUpdate() {
        if (pickaxeSwitch.getValue()) {
            if (!(mc.player.getMainHandStack().getItem() instanceof PickaxeItem) && mc.player.getMainHandStack().getItem() != Items.ENCHANTED_GOLDEN_APPLE) {
                swapped = false;
                return;
            }
            int gapple = InventoryUtil.findItem(Items.ENCHANTED_GOLDEN_APPLE);
            if (gapple == -1) {
                if (swapped) {
                    InventoryUtil.switchToSlot(lastSlot);
                    swapped = false;
                }
                return;
            }
            if (mc.options.useKey.isPressed()) {
                if (mc.player.getMainHandStack().getItem() instanceof PickaxeItem && mc.player.getOffHandStack().getItem() != Items.ENCHANTED_GOLDEN_APPLE) {
                    lastSlot = mc.player.getInventory().selectedSlot;
                    InventoryUtil.switchToSlot(gapple);
                    swapped = true;
                }
            } else if (swapped) {
                InventoryUtil.switchToSlot(lastSlot);
                swapped = false;
            }
        }
    }

    public boolean isActive;

    @Override
    public void onDisable() {
        isActive = false;
    }

    public boolean noAbort() {
        return isOn() && noAbort.getValue() && !mc.options.useKey.isPressed();
    }

    public boolean noReset() {
        return isOn() && noReset.getValue();
    }
    public boolean noDelay() {
        return isOn() && noDelay.getValue();
    }
    public boolean multiTask() {
        return isOn() && multiTask.getValue();
    }

    public boolean noEntityTrace() {
        if (isOff() || !noEntityTrace.getValue()) return false;

        if (onlyPickaxe.getValue()) {
            return mc.player.getMainHandStack().getItem() instanceof PickaxeItem || mc.player.isUsingItem() && !(mc.player.getMainHandStack().getItem() instanceof SwordItem);
        }
        return true;
    }

    public boolean ghostHand() {
        return isOn() && ghostHand.getValue() && !mc.options.useKey.isPressed() && !mc.options.sneakKey.isPressed();
    }
}
